<!DOCTYPE html>
<html>
<head>
    <title>Enhanced Dependencies Viewer</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .node { border: 2px solid #ccc; border-radius: 8px; padding: 10px; margin: 5px; display: inline-block; min-width: 150px; }
        .critical { border-color: #4CAF50; background: #E8F5E8; }
        .question { border-color: #2196F3; background: #E3F2FD; }
        .rejected { border-color: #f44336; background: #FFEBEE; }
        .dependency-info { font-size: 12px; color: #666; margin-top: 5px; }
        .phase-1 { border-left: 5px solid #FF5722; }
        .phase-2 { border-left: 5px solid #FF9800; }
        .phase-3 { border-left: 5px solid #4CAF50; }
        .risk-high { box-shadow: 0 0 5px red; }
        .risk-medium { box-shadow: 0 0 5px orange; }
        .risk-low { box-shadow: 0 0 5px green; }
        .controls { margin-bottom: 20px; }
        button { margin: 5px; padding: 8px 16px; }
    </style>
</head>
<body>
    <h1>Enhanced Dependencies Viewer</h1>
    
    <div class="controls">
        <button onclick="showPhase(1)">Phase 1</button>
        <button onclick="showPhase(2)">Phase 2</button>
        <button onclick="showPhase(3)">Phase 3</button>
        <button onclick="showAll()">All</button>
        <button onclick="showDependencies()">Show Dependencies</button>
    </div>

    <div id="nodes-container"></div>
    <div id="dependencies-container"></div>

    <script>
        let nodesData = null;

        async function loadData() {
            try {
                const response = await fetch('nodes_v1_enhanced.json');
                nodesData = await response.json();
                renderNodes();
            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('nodes-container').innerHTML = '<p>Error loading data. Check console.</p>';
            }
        }

        function renderNodes(filter = null) {
            const container = document.getElementById('nodes-container');
            container.innerHTML = '';

            Object.values(nodesData.nodes).forEach(node => {
                if (filter && !filter(node)) return;

                const nodeEl = document.createElement('div');
                nodeEl.className = `node ${node.type}`;
                
                if (node.dependencies) {
                    const phase = node.dependencies.phase || 0;
                    nodeEl.classList.add(`phase-${phase}`);
                    
                    const risk = node.dependencies.risk || 'low';
                    nodeEl.classList.add(`risk-${risk}`);
                }

                nodeEl.innerHTML = `
                    <div><strong>${node.title}</strong></div>
                    <div>${node.description || ''}</div>
                    ${node.dependencies ? `
                        <div class="dependency-info">
                            Weight: ${node.dependencies.weight || 'N/A'} | 
                            Risk: ${node.dependencies.risk || 'N/A'} |
                            Phase: ${node.dependencies.phase || 'N/A'}
                            ${node.dependencies.enables ? `<br>Enables: ${node.dependencies.enables.join(', ')}` : ''}
                        </div>
                    ` : ''}
                `;

                container.appendChild(nodeEl);
            });
        }

        function showPhase(phase) {
            renderNodes(node => node.dependencies && node.dependencies.phase === phase);
        }

        function showAll() {
            renderNodes();
        }

        function showDependencies() {
            const container = document.getElementById('dependencies-container');
            if (!nodesData.dependency_graph) return;

            container.innerHTML = '<h3>Dependencies:</h3>';
            nodesData.dependency_graph.edges.forEach(edge => {
                const edgeEl = document.createElement('div');
                edgeEl.innerHTML = `${edge.from} â†’ ${edge.to} (${edge.type}, ${edge.strength})`;
                container.appendChild(edgeEl);
            });
        }

        loadData();
    </script>
</body>
</html>