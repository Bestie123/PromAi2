### Уровень 0 — Несущие стены проекта (Фундамент)
Без этого вообще нет продукта. Делать строго с первого дня, иначе потом переписывать годами.

| №  | Критерий                                                                     | Обяз./Желат. | Для чего это нужно                                                           | Последствия, если не сделать сразу                                                                      |
|----|----------------------------------------------------------------------------|--------------|-------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------|
| 1  | Модульность движка (ядро легко отделяется от UI и плагинов)                | Обязательный | Легко тестировать, заменять UI-фреймворк, мобильные/десктоп версии           | Монолитный спагетти-код, смена UI = переписывание половины проекта                                      |
| 2  | Блочность добавляемых элементов (всё — блоки)                              | Обязательный | Единая модель данных, единые операции, единый рендер                         | Появятся «особые» сущности → ломаются refs, поиск, transclusion, плагины                               |
| 3  | У каждого блока свой уникальный глобальный UUID (v4/v7, не меняется)       | Обязательный | Надёжная идентификация при merge, синхронизации, E2EE, миграции             | Невозможно надёжный merge, P2P-синхронизацию, E2EE и перенос базы                                       |
| 4  | Вложенные блоки (иерархия любой глубины)                                   | Обязательный | Естественная структура мыслей и документов                                   | Невозможно делать нормальные документы и заметки                                                        |
| 5  | Порядок дочерних блоков сохраняется и меняется drag & drop                 | Обязательный | Интуитивное управление структурой                                            | Хаос в документах, пользователи будут страдать                                                          |
| 6  | Каждый блок может содержать богатый текст (Markdown-подобный + сущности)   | Обязательный | Удобный ввод и читаемость                                                    | Плохой UX при копировании текста из других приложений                                                   |
| 7  | Refs: любой блок может ссылаться на любой другой по UUID                  | Обязательный | Основа knowledge graph                                                       | Без жёстких ссылок невозможно transclusion, быстрые queries, graph view                                |
| 8  | Backlinks: мгновенный доступ к обратным ссылкам                            | Обязательный | Двусторонние связи — главный козырь Roam-like инструментов                   | Односторонние ссылки → мёртвый граф, пользователи не видят контекст                                     |
| 9  | Все данные локально в открытом читаемом формате (JSON или SQLite)          | Обязательный | Прозрачность, скрипты, бэкапы                                                | Vendor lock-in, невозможность автоматизации                                                             |
| 10 | Полная оффлайн-работа                                                      | Обязательный | Работа в самолёте, метро, на даче — must-have для PKM                        | Ограниченная аудитория                                                                                  |
| 11 | UI 100 % декларативный (JSON-структуры / ViewScript)                       | Обязательный | Предсказуемый рендер, лёгкая отладка, темы и плагины                         | Хаотичный imperative-код → необъяснимые баги UI                                                         |
| 12 | Zero runtime logic в рендере (чистая функция)                              | Обязательный | Нет race conditions, предсказуемость, лёгкий SSR                             | Через 30–40 плагинов начнутся необъяснимые глюки интерфейса                                             |
| 13 | Single source of truth = CRDT (Yjs / Automerge)                             | Обязательный | Будущая коллаборация, оффлайн-merge без конфликтов                           | Без CRDT потом невозможно добавить реальную коллаборацию                                               |
| 14 | Immutable ops log + Event Sourcing с первого дня                            | Обязательный | Полный аудит, versioning, откаты, branching                                  | Без лога невозможно block-level versioning, нормальную историю и откаты                                |
| 15 | Schema-first + runtime валидация                                            | Обязательный | Совместимость плагинов, безопасные обновления и миграции                    | Зоопарк несовместимых плагинов и поломка данных при обновлениях                                         |
| 16 | Все изменения только через CRDT-операции                                    | Обязательный | Будущая коллаборация и оффлайн-merge без боли                                | Добавление коллаборации потом = полный рефакторинг данных                                              |
| 17 | Атомарные транзакции операций                                               | Обязательный | Целостность данных, нормальный undo/redo                                     | Полублоки и сломанные связи после undo                                                                  |
| 18 | References и backlinks — first-class в CRDT                                 | Обязательный | Быстрые запросы и транслюзия                                                 | Медленные и ненадёжные ссылки, если хранить только в тексте                                             |
| 19 | Блоки ≠ страницы (плоский граф блоков)                                      | Обязательный | Гибкие transclusion и queries                                                | Как у 95 % конкурентов — потом невозможно нормально делать транслюзию                                  |
| 20 | Отсутствие глобального mutable состояния в UI                               | Обязательный | Предсказуемость и отладка                                                    | Race conditions и необъяснимые баги через полгода-год                                                   |
| 21 | Virtual scrolling + ленивая загрузка                                        | Обязательный | Работа с 100 к+ блоков без тормозов                                          | Привычка «всё в DOM» убьёт производительность навсегда                                                  |
| 22 | Web Workers для всех тяжёлых операций                                      | Обязательный | UI остаётся отзывчивым даже на 200 к+ блоков                                 | UI будет зависать при поиске/индексации                                                                |
| 23 | Circular Reference Detection + безопасная обработка циклов                  | Обязательный | Предотвращение бесконечных циклов при транслюзии и рендере                  | Циклы = краш или бесконечный рендер                                                                     |
| 24 | E2EE-ready формат хранения с первого дня                                    | Обязательный | Возможность шифрования без breaking changes                                  | Добавление E2EE потом = почти невозможная миграция всех баз пользователей                               |
| 25 | Конфликт-менеджмент при синхронизации (CRDT-merge)                          | Обязательный | Оффлайн-first без потери данных                                              | Пользователи будут терять данные при одновременном редактировании                                       |
| 26  | Все пользовательские блоки подключаются как плагины (единый механизм)   | Обязательный | Единая архитектура расширений, предсказуемость, безопасность |
| 27  | Поддержка кастомных блоков, содержащих другие блоки (композитные блоки) | Обязательный | Возможность создавать сложные структуры (карточки, дашборды и т.д.) |
| 28  | Каждый блок может иметь собственное сохраняемое состояние (JSON)         | Обязательный | Плагины сохраняют настройки, виджеты работают корректно   |
| 29  | Максимальная модульность кода: файлы ≤500 строк (макс 1000), функции ≤50 строк (макс 100), параметры ≤3 (макс 5) | Обязательный | Читаемость, поддерживаемость, легкое тестирование, AI-friendly | Монолитный код, невозможность рефакторинга, технический долг, AI не может анализировать |

### Уровень 1 — Core UX и «магия» (первые 3–6 месяцев после MVP)

| №  | Критерий                                                  | Обяз./Желат. | Для чего это нужно                                      | Последствия, если отложить                                      |
|----|-----------------------------------------------------------|--------------|--------------------------------------------------------|-----------------------------------------------------------------|
| 1  | Live update без задержек (взаимное изменение в реальном времени) | Обязательный | Ощущение «живого» документа                            | Потом невозможно ускорить без полного рефакторинга рендера     |
| 2  | Перемещение блоков drag & drop + модификаторы (копия, ссылка)  | Обязательный | Основной способ реорганизации знаний                   | Медленная и раздражающая работа                                 |
| 3  | Undo/Redo (глубокая история ≥ 1000 шагов)                 | Обязательный | Смелое экспериментирование без страха                  | Пользователи будут бояться что-то трогать                       |
| 4  | Автосохранение каждые 3–5 сек + версии/snapshots          | Обязательный | Никогда не потерять данные                             | Одна авария браузера = потерянные часы работы → репутационный крах |
| 5  | Коллапс/разворот вложенных блоков + Bullet threading     | Обязательный | Читаемость и фокус                                     | Длинные документы становятся нечитаемыми                        |
| 6  | Live preview + WYSIWYG Markdown                           | Обязательный | Удобный ввод без переключения режимов                  | Пользователи будут страдать от «режима кода»                    |
| 7  | Transclusion / Embed блоков с живой синхронизацией        | Обязательный | Повторное использование контента — главная суперсила   | Инструмент теряет 50 % своей ценности                           |
| 8  | Full-text search с постоянной индексацией (WASM-Tantivy)  | Обязательный | Мгновенный поиск даже на 100 к+ блоков                 | Медленный поиск = приложение непригодно при росте базы          |
| 9  | Cross-Tab Synchronization                                 | Обязательный | Одинаковое состояние во всех вкладках                  | Путаница у пользователя                                         |
| 10 | Персистентные человекочитаемые алиасы ([[Person/Ivan]])   | Обязательный | Удобные ссылки вместо UUID                             | Пользователи будут путаться в голых UUID                        |
| 11 |  Перекрестные ссылки и взаимосвязанные ссылки с автоматическими backlinks [[…]]               | Обязательный | Магия двусторонних связей                              | Ручные ссылки = мёртвая фича                                    |
| 12  | Полноценный WYSIWYG-редактор богатого текста внутри блоков:          | Обязательный | Комфортный ввод текста без Markdown-ущерба              |
|     | • изменение цвета, фона, размера, стиля шрифта                       |              |                                                         |
|     | • жирный, курсив, подчёркивание, зачёркивание                        |              |                                                         |
|     | • надстрочный/подстрочный текст                                      |              |                                                         |
|     | • выравнивание (по левому краю, центру, правому, по ширине)          |              |                                                         |
|     | • изменение междустрочного интервала и отступов                      |              |                                                         |
| 13  | Пронумерованные и маркированные списки с произвольной вложенностью   | Обязательный | Естественная структура документов                       |
| 14  | Сворачивание/разворачивание любых блоков (collapse)                  | Обязательный | Читаемость длинных документов                           |
| 15  | Вставка медиа: изображения, видео, аудио, галереи                    | Обязательный | Единое хранилище всего контента                         |
| 16  | Вставка и редактирование таблиц с расширенными возможностями:       | Обязательный | Работа с табличными данными без ухода в Excel           |
|     | • объединение/разбиение ячеек                                        |              |                                                         |
|     | • регулировка ширины столбцов и высоты строк мышью                   |              |                                                         |
|     | • подставление данных из других блоков/переменных/JSON               |              |                                                         |

### Уровень 2 — Продуктивность и рост базы знаний (6–18 месяцев)

| №  | Критерий                                                             | Обяз./Желат. | Для чего это нужно                                           | Последствия, если отложить                                      |
|----|----------------------------------------------------------------------|--------------|-------------------------------------------------------------|-----------------------------------------------------------------|
| 1  | Graph view (граф связей)                                             | Обязательный | Видеть связи и структуру знаний наглядно                    | Инструмент становится «продвинутым Markdown» без суперсилы      |
| 2 | Timeline / Roadmap view (хронология блоков с датами)                    | Обязательный | Рядом с Graph view                                   |
|3  | Горячие клавиши                                                      | Обязательный | Продуктивность power-пользователей                          | Отток в Vim/Emacs-подобные инструменты                          |
| 4  | Экспорт/импорт всей базы (JSON + другие открытые форматы)            | Обязательный | Data ownership, миграция, бэкапы                            | Страх vendor lock-in → пользователи не вкладываются             |
| 5  | Теги, Properties/Attributes у блоков с индексацией                   | Обязательный | Структурированные данные, фильтры, сортировка               | Слабая структуризация, хаос в большой базе                      |
| 6  | Query Language (типа Datalog/Logseq-query)                           | Обязательный | Динамические представления и дашборды                      | Ограниченная гибкость                                           |
| 7 | Kanban-доски как нативный тип представления (на основе query)          | Обязательный | После Query Language                                 |
| 8  | Templates + Template blocks                                          | Обязательный | Быстрое создание однотипных структур                        | Ручное копирование → потеря времени                            |
| 9  | Block-level versioning + Version diff & compare                      | Обязательный | История и откат отдельных блоков                            | Невозможно откатить один блок без потери других данных          |
| 10  | Code blocks с исполнением (Mermaid, Markdown-блоки (как отдельный тип блока), диаграммы, графики, LaTeX, Excalidraw и т.д.)        | Обязательный | Живые диаграммы и вычисления в заметках                     | Остаётся «только текстом»                                       |
| 11 | Аннотации PDF/изображений/видео внутри блоков                        | Обязательный | Единое место для всего контента                             | Разрыв знаний (PDF отдельно)                                    |
| 12 | Полноценный публичный Plugin API + магазин                          | Обязательный | Экосистема — главный драйвер роста                          | Остаётся нишевым приложением                                    |
| 13 | Namespaces / Workspaces                                              | Обязательный | Разделение личного/рабочего/проектов                        | Всё в одной куче → быстро тонет в хаосе                         |
| 14 | Режим «только чтение» и «презентация»                                | Обязательный | Публикация и шаринг без риска изменения                     | Невозможно делиться знаниями                                    |
| 15 | Возможность программно читать/изменять базу                         | Обязательный | Автоматизация, скрипты, интеграции                          | Программисты уйдут                                              |

### Уровень 3 — Безопасность и здоровая экосистема плагинов (12–24 месяца)

| № | Критерий                                              | Обяз./Желат. | Для чего это нужно                              | Последствия, если отложить                          |
|---|-------------------------------------------------------|--------------|------------------------------------------------|-----------------------------------------------------|
| 1 | Каждый плагин — отдельный файл + tree-shaking, ленивая загрузка | Обязательный | Простая установка/удаление, производительность | Плагины «сливаются» в один бандл → тормоза          |
| 2 | Sandbox + capability-based permissions для плагинов   | Обязательный | Безопасность и доверие пользователей           | Один плохой плагин может украсть/сломать всё        |
| 3 | Error Boundaries для плагинов                         | Обязательный | Один упавший плагин не валит весь редактор     | Падение одного плагина = падение всего приложения   |
| 4 | Автоматические тесты для плагинов                     | Обязательный | Совместимость после обновлений ядра            | Плагины ломаются при каждом обновлении → плохая репутация |
| 5   | Поддержка интерактивных блоков: скрипты для кастомной отрисовки и редактирования | Обязательный | Живые виджеты, кастомные визуализации               |
| 6   | Модальные окна, управляемые из плагинов                                       | Обязательный | Нормальный UX для сложных плагинов                  |
| 7   | Редактирование любых блоков через публичное скриптовое API                    | Обязательный | Полная программируемость                            |

### Уровень 4 — Nice-to-have и «вау-фичи» (1–3 года и позже)

| №   | Критерий                                       | Обяз./Желат. | Для чего это нужно                               | Можно отложить?          |
| --- | ---------------------------------------------- | ------------ | ------------------------------------------------ | ------------------------ |
| 1   | Тёмная/светлая + пользовательские CSS-темы     | Обязательный | Комфорт и персонализация                         | Нет (но можно после MVP) |
| 2   | Zoom / фокус на блоке                          | Желательный  | Глубокая концентрация                            | Да                       |
| 3   | Вкладки / split-view (несколько документов)    | Желательный  | Работа с несколькими контекстами                 | Да                       |
| 4   | Whiteboards / Infinite canvas с живыми блоками | Желательный  | Свободное пространственное мышление              | Да                       |
| 5   | Spatial mode (2D/3D расстановка блоков)        | Желательный  | Новый способ организации идей                    | Да                       |
| 6   | Timeline view                                  | Желательный  | Хронологический обзор                            | Да                       |
| 7   | Custom renderers (карты, графики, 3D и т.д.)   | Желательный  | Неограниченная визуализация                      | Да                       |
| 8   | Плагины на WebAssembly                         | Желательный  | Почти нативная скорость                          | Да                       |
| 9   | Multi-Window Sync                              | Желательный  | Совместная работа в нескольких окнах             | Да                       |
| 10  | JIT Compilation горячих путей                  | Желательный  | Максимальная производительность на больших базах | Да                       |
| 11  | Plugin-to-plugin communication protocol | Желательный  | Возможность создавать сложные составные плагины (например, календарь + задачи + диаграммы Gantt, AI-ассистенты, интеграции с внешними сервисами и т.д.) | Можно добавить позже, но будет сложнее: придётся переписывать старые плагины под новый протокол. Без него экосистема останется примитивной |
| 12 | Вложенные страницы / подстраницы внутри документа                       | Желательный  | Можно перенести в уровень 4 как nice-to-have        |
| 13 | Разделение окна на панели (split-view): настройки, задачи, документ и т.д.| Желательный  | Ближе к концу уровня 2 или в уровень 4              |
| 14   | Отрисовка линий между связанными блоками (визуализация иерархии/связей) | Желательный  | Лучше в уровень 4 (это уже «вау»)                   |
| 15   | Drag & drop блоков между разными окнами/вкладками         | Желательный  | Расширение существующего drag & drop            |
| 16   | Отрисовка связей линиями в обычном режиме (не только в graph view) | Желательный  | Визуализация иерархии прямо в документе         |
