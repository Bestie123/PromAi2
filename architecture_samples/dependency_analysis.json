{
  "meta": {
    "version": "2.0.0",
    "updated": "2024-12-19",
    "description": "Полный анализ зависимостей архитектуры PromAi PKM"
  },
  "critical_path": {
    "description": "Критический путь разработки - узлы, блокирующие весь проект",
    "path": [
      {
        "step": 1,
        "node": "modular-arch",
        "criteriaId": 1,
        "reason": "Блокирует UI, плагины, модульность кода",
        "blocks": [11, 12, 26, 29],
        "estimatedWeeks": 2
      },
      {
        "step": 2,
        "node": "all-blocks",
        "criteriaId": 2,
        "reason": "Блокирует всю структуру данных и ссылки",
        "blocks": [4, 7, 8, 16, 18, 19],
        "estimatedWeeks": 3
      },
      {
        "step": 3,
        "node": "uuid-v4",
        "criteriaId": 3,
        "reason": "Блокирует систему ссылок",
        "blocks": [7, 8, 18],
        "estimatedWeeks": 1
      },
      {
        "step": 4,
        "node": "yjs-crdt",
        "criteriaId": 13,
        "reason": "Блокирует операции и синхронизацию",
        "blocks": [14, 16, 18, 25],
        "estimatedWeeks": 4
      },
      {
        "step": 5,
        "node": "declarative-ui",
        "criteriaId": 11,
        "reason": "Блокирует рендер и производительность",
        "blocks": [12, 20, 21],
        "estimatedWeeks": 3,
        "dependsOn": [1]
      },
      {
        "step": 6,
        "node": "virtual-scrolling",
        "criteriaId": 21,
        "reason": "Критично для производительности",
        "blocks": [22],
        "estimatedWeeks": 4,
        "dependsOn": [11]
      },
      {
        "step": 7,
        "node": "plugin-unified",
        "criteriaId": 26,
        "reason": "Блокирует расширяемость",
        "blocks": [27, 28],
        "estimatedWeeks": 5,
        "dependsOn": [1, 11]
      }
    ],
    "totalWeeks": 22,
    "parallelizable": false
  },
  "dependency_matrix": {
    "description": "Матрица зависимостей между критериями",
    "matrix": {
      "1": {
        "enables": [11, 12, 26, 29],
        "enabledBy": [],
        "blocks": [11, 12, 26, 29],
        "blockedBy": [],
        "type": "foundation"
      },
      "2": {
        "enables": [4, 7, 8, 16, 18, 19],
        "enabledBy": [],
        "blocks": [4, 7, 8, 16, 18, 19],
        "blockedBy": [],
        "type": "foundation"
      },
      "3": {
        "enables": [7, 8, 18],
        "enabledBy": [],
        "blocks": [7, 8, 18],
        "blockedBy": [],
        "type": "foundation"
      },
      "11": {
        "enables": [12, 20, 21],
        "enabledBy": [1],
        "blocks": [12, 20, 21],
        "blockedBy": [1],
        "type": "core"
      },
      "12": {
        "enables": [],
        "enabledBy": [1, 11],
        "blocks": [],
        "blockedBy": [1, 11],
        "type": "core"
      },
      "13": {
        "enables": [14, 16, 18, 25],
        "enabledBy": [],
        "blocks": [14, 16, 18, 25],
        "blockedBy": [],
        "type": "foundation"
      },
      "21": {
        "enables": [22],
        "enabledBy": [11],
        "blocks": [22],
        "blockedBy": [11],
        "type": "features"
      },
      "26": {
        "enables": [27, 28],
        "enabledBy": [1],
        "blocks": [27, 28],
        "blockedBy": [1],
        "type": "features"
      }
    }
  },
  "development_order": {
    "description": "Оптимальный порядок разработки с учетом зависимостей",
    "phases": {
      "phase1_foundation": {
        "order": 1,
        "parallel": false,
        "description": "Фундаментальные решения - нельзя менять потом",
        "criteria": [1, 2, 3, 13],
        "nodes": ["modular-arch", "all-blocks", "uuid-v4", "yjs-crdt"],
        "estimatedWeeks": 10,
        "risk": "high",
        "blockers": [],
        "deliverables": [
          "MODULE_Core_VER_1 структура",
          "Block schema v1.0",
          "CRDT операции базовые",
          "UUID система"
        ]
      },
      "phase2_core": {
        "order": 2,
        "parallel": true,
        "description": "Основная функциональность",
        "criteria": [11, 12, 4, 7, 8],
        "nodes": ["declarative-ui", "zero-runtime", "nested-blocks", "refs-uuid", "backlinks-auto"],
        "estimatedWeeks": 6,
        "risk": "medium",
        "blockers": [1, 2, 3, 13],
        "parallelTracks": [
          {
            "track": "UI",
            "criteria": [11, 12],
            "weeks": 5
          },
          {
            "track": "Data",
            "criteria": [4, 7, 8],
            "weeks": 4
          }
        ],
        "deliverables": [
          "MODULE_UI_VER_1",
          "Render система",
          "Refs система",
          "Backlinks автоматические"
        ]
      },
      "phase3_features": {
        "order": 3,
        "parallel": true,
        "description": "Ключевые возможности",
        "criteria": [16, 21, 26, 9, 10],
        "nodes": ["crdt-only", "virtual-scrolling", "plugin-unified", "json-storage", "offline-full"],
        "estimatedWeeks": 8,
        "risk": "high",
        "blockers": [1, 2, 3, 11, 13],
        "parallelTracks": [
          {
            "track": "Performance",
            "criteria": [21, 22],
            "weeks": 6
          },
          {
            "track": "Plugins",
            "criteria": [26, 27, 28],
            "weeks": 8
          },
          {
            "track": "Storage",
            "criteria": [9, 10, 16],
            "weeks": 5
          }
        ],
        "deliverables": [
          "MODULE_Plugin_VER_1",
          "Virtual scrolling",
          "Storage система",
          "Offline режим"
        ]
      },
      "phase4_polish": {
        "order": 4,
        "parallel": true,
        "description": "Доводка и оптимизация",
        "criteria": [14, 15, 17, 18, 19, 20, 22, 23, 24, 25, 27, 28, 29],
        "estimatedWeeks": 10,
        "risk": "low",
        "blockers": [1, 2, 3, 11, 13, 21, 26],
        "parallelTracks": [
          {
            "track": "Quality",
            "criteria": [15, 17, 23, 29],
            "weeks": 6
          },
          {
            "track": "Advanced",
            "criteria": [14, 18, 19, 20, 24, 25],
            "weeks": 8
          },
          {
            "track": "UX",
            "criteria": [5, 6, 22, 27, 28],
            "weeks": 7
          }
        ],
        "deliverables": [
          "Event sourcing",
          "Schema validation",
          "E2EE готовность",
          "Полная функциональность"
        ]
      }
    }
  },
  "risk_analysis": {
    "description": "Анализ рисков по зависимостям",
    "high_risk_nodes": {
      "yjs-crdt": {
        "criteriaId": 13,
        "risk": "Сложная интеграция CRDT может заблокировать 4 других критерия",
        "impact": [14, 16, 18, 25],
        "mitigation": "Прототип CRDT операций в первую неделю"
      },
      "virtual-scrolling": {
        "criteriaId": 21,
        "risk": "Производительность критична для UX",
        "impact": [22],
        "mitigation": "Benchmark с 100k блоков"
      },
      "plugin-unified": {
        "criteriaId": 26,
        "risk": "Архитектура плагинов влияет на расширяемость",
        "impact": [27, 28],
        "mitigation": "Sandbox прототип"
      }
    },
    "bottlenecks": [
      {
        "node": "modular-arch",
        "reason": "Блокирует 4 критерия, нельзя распараллелить",
        "impact": "Задержка на 2 недели блокирует весь проект"
      },
      {
        "node": "declarative-ui", 
        "reason": "Блокирует производительность и рендер",
        "impact": "Без этого нельзя делать virtual scrolling"
      }
    ]
  },
  "validation_rules": {
    "description": "Правила валидации зависимостей",
    "hard_constraints": [
      {
        "rule": "foundation_first",
        "description": "Критерии 1,2,3,13 должны быть завершены до начала фазы 2",
        "criteria": [1, 2, 3, 13]
      },
      {
        "rule": "ui_before_performance",
        "description": "Декларативный UI (11) до virtual scrolling (21)",
        "sequence": [11, 21]
      },
      {
        "rule": "modular_before_plugins",
        "description": "Модульность (1) до плагинов (26)",
        "sequence": [1, 26]
      }
    ],
    "soft_constraints": [
      {
        "rule": "parallel_tracks",
        "description": "В фазе 2+ можно параллелить треки",
        "phases": [2, 3, 4]
      },
      {
        "rule": "risk_mitigation",
        "description": "Высокорисковые узлы - прототипы в первую неделю",
        "nodes": ["yjs-crdt", "virtual-scrolling", "plugin-unified"]
      }
    ]
  },
  "module_dependencies": {
    "description": "Зависимости между модулями кода",
    "modules": {
      "MODULE_Core_VER_1": {
        "dependsOn": [],
        "enables": ["MODULE_UI_VER_1", "MODULE_Plugin_VER_1", "MODULE_Search_VER_1"],
        "criteria": [1, 2, 3],
        "phase": 1
      },
      "MODULE_CRDT_VER_1": {
        "dependsOn": [],
        "enables": ["MODULE_Storage_VER_1"],
        "criteria": [13],
        "phase": 1
      },
      "MODULE_UI_VER_1": {
        "dependsOn": ["MODULE_Core_VER_1"],
        "enables": ["MODULE_Plugin_VER_1"],
        "criteria": [11, 12, 21],
        "phase": 2
      },
      "MODULE_Storage_VER_1": {
        "dependsOn": ["MODULE_CRDT_VER_1"],
        "enables": [],
        "criteria": [9, 10, 16],
        "phase": 3
      },
      "MODULE_Plugin_VER_1": {
        "dependsOn": ["MODULE_Core_VER_1", "MODULE_UI_VER_1"],
        "enables": [],
        "criteria": [26, 27, 28],
        "phase": 3
      },
      "MODULE_Search_VER_1": {
        "dependsOn": ["MODULE_Core_VER_1"],
        "enables": [],
        "criteria": [22],
        "phase": 4
      }
    }
  },
  "success_metrics": {
    "description": "Метрики успешности каждой фазы",
    "phase1": {
      "criteria": "Все foundation критерии реализованы",
      "tests": [
        "Создание/изменение блоков через CRDT",
        "UUID генерация и валидация",
        "Модульная загрузка компонентов"
      ]
    },
    "phase2": {
      "criteria": "UI рендерит блоки декларативно",
      "tests": [
        "Рендер 1000 блоков без тормозов",
        "Refs и backlinks работают",
        "Zero runtime logic в рендере"
      ]
    },
    "phase3": {
      "criteria": "Производительность и расширяемость",
      "tests": [
        "100k блоков с virtual scrolling",
        "Плагин загружается и работает",
        "Оффлайн сохранение/загрузка"
      ]
    },
    "phase4": {
      "criteria": "Production ready",
      "tests": [
        "Все 29 критериев реализованы",
        "E2EE архитектура готова",
        "Конфликты CRDT разрешаются"
      ]
    }
  }
}